<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>reConnect - Settings</title>
    <!-- Lucide Icons Library -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* THEME VARIABLES */
        :root {
            --rc-primary-blue: #3b489a;
            --rc-accent-gold: #e1a92a;
            --rc-page-background: #f3f4f9;
            --rc-content-white: #ffffff;
            --rc-text-main-color: #1e293b;
            --rc-text-dimmed-color: #64748b;
            --rc-ui-border-soft: #e2e8f0;
            --rc-card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', -apple-system, sans-serif; }
        body { background-color: var(--rc-page-background); color: var(--rc-text-main-color); min-height: 100vh; }

        /* Navigation Header */
        .rc-header {
            position: sticky; top: 0; z-index: 1000; background-color: var(--rc-primary-blue);
            color: white; padding: 12px 28px; display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 4px 14px rgba(0,0,0,0.1);
        }
        .rc-logo-btn { background: transparent; border: none; cursor: pointer; display: flex; align-items: center; text-decoration: none; }
        .rc-logo-text { font-size: 1.8rem; font-weight: 900; letter-spacing: -1.2px; color: white; }
        .rc-logo-text span { color: var(--rc-accent-gold); }

        .rc-header-right { display: flex; align-items: center; gap: 20px; }
        .rc-profile-link { display: flex; align-items: center; gap: 12px; text-decoration: none; color: white; border-left: 1px solid rgba(255,255,255,0.2); padding-left: 20px; }

        /* SIDEBAR NAVIGATION OVERLAY */
        .rc-nav-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 90px;
            background: white; z-index: 1100; border-bottom: 4px solid var(--rc-accent-gold);
            display: flex; align-items: center; padding: 0 28px;
            transform: translateX(-100%); transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: var(--rc-card-shadow);
        }
        .rc-nav-overlay.open { transform: translateX(0); }
        .rc-nav-list { display: flex; gap: 10px; flex: 1; align-items: center; padding: 0 20px; overflow-x: auto; scrollbar-width: none; }
        .rc-nav-link { 
            display: flex; align-items: center; gap: 8px; padding: 10px 20px; 
            border-radius: 50px; text-decoration: none; color: var(--rc-text-dimmed-color); 
            font-weight: 700; font-size: 0.9rem; transition: 0.2s; white-space: nowrap;
        }
        .rc-nav-link.active { background: var(--rc-primary-blue); color: white; }

        /* Main Grid Layout */
        .rc-settings-grid {
            max-width: 1100px;
            margin: 30px auto;
            padding: 0 24px;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 30px;
            align-items: start;
        }

        /* Settings Sidebar */
        .rc-settings-nav {
            background: white; border-radius: 24px; padding: 15px;
            border: 1px solid var(--rc-ui-border-soft); box-shadow: var(--rc-card-shadow);
        }
        .rc-settings-tab {
            width: 100%; display: flex; align-items: center; gap: 12px;
            padding: 14px 18px; border-radius: 12px; border: none; background: transparent;
            color: var(--rc-text-dimmed-color); font-weight: 700; cursor: pointer;
            transition: 0.2s; text-align: left;
        }
        .rc-settings-tab:hover { background: #f8fafc; color: var(--rc-primary-blue); }
        .rc-settings-tab.active { background: #eff6ff; color: var(--rc-primary-blue); }

        /* Content Sections */
        .rc-settings-content { display: flex; flex-direction: column; gap: 25px; }
        .rc-card { 
            background: white; border-radius: 24px; padding: 30px;
            border: 1px solid var(--rc-ui-border-soft); box-shadow: var(--rc-card-shadow);
        }
        .rc-card-title { font-size: 1.2rem; font-weight: 900; color: var(--rc-primary-blue); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        
        /* Form Elements */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 800; font-size: 0.75rem; color: var(--rc-text-dimmed-color); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        .form-control { 
            width: 100%; padding: 14px 18px; border-radius: 12px; border: 1.5px solid var(--rc-ui-border-soft);
            font-size: 1rem; font-weight: 600; outline: none; transition: 0.2s; background: #fcfdfe;
        }
        .form-control:focus { border-color: var(--rc-accent-gold); box-shadow: 0 0 0 4px rgba(225, 169, 42, 0.1); }
        .form-control:disabled { background: #f1f5f9; color: var(--rc-text-dimmed-color); cursor: not-allowed; border-style: dashed; }

        /* Buttons */
        .rc-btn {
            padding: 12px 24px; border-radius: 12px; font-weight: 800; font-size: 0.9rem; cursor: pointer;
            transition: 0.2s; border: none; display: inline-flex; align-items: center; gap: 8px;
        }
        .rc-btn-primary { background: var(--rc-primary-blue); color: white; }
        .rc-btn-primary:hover { opacity: 0.9; transform: translateY(-2px); }
        .rc-btn-gold { background: var(--rc-accent-gold); color: var(--rc-primary-blue); }

        /* Verified Badge */
        .verified-badge { background: #dcfce7; color: #15803d; font-size: 0.65rem; padding: 4px 8px; border-radius: 6px; font-weight: 900; margin-left: auto; }

        .hidden { display: none; }

        /* Notification Prefs */
        .pref-item { display: flex; align-items: center; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid var(--rc-ui-border-soft); }
        .pref-item:last-child { border-bottom: none; }
        .pref-info h4 { font-size: 0.95rem; font-weight: 800; color: var(--rc-text-main-color); }
        .pref-info p { font-size: 0.8rem; color: var(--rc-text-dimmed-color); font-weight: 600; }

        /* Toggle Switch */
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background-color: #cbd5e1; transition: .3s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .3s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--rc-primary-blue); }
        input:checked + .slider:before { transform: translateX(20px); }

        @media (max-width: 850px) {
            .rc-settings-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <!-- SIDEBAR NAVIGATION OVERLAY -->
    <nav id="sidebarOverlay" class="rc-nav-overlay">
        <button onclick="toggleNav()" style="background:transparent; border:none; cursor:pointer; padding:10px;">
            <i data-lucide="x" color="#3b489a" size="32"></i>
        </button>
        <div class="rc-nav-list" id="navContainer">
            <!-- Nav Items injected by JS -->
        </div>
        <a href="{% url 'logout' %}" style="color:var(--rc-ui-alert-danger); text-decoration:none; font-weight:800; border-left:1px solid #eee; padding-left:24px; margin-left:12px; display:flex; align-items:center; gap:8px;">
            <i data-lucide="log-out" size="20"></i> Logout
        </a>
    </nav>

    <!-- HEADER -->
    <header class="rc-header">
        <button class="rc-logo-btn" onclick="toggleNav()">
            <span class="rc-logo-text">re<span>Connect</span></span>
        </button>
        <div class="rc-header-right">
            <i data-lucide="bell" size="24" style="cursor: pointer;"></i>
            <a href="{% url 'my_profile' %}" class="rc-profile-link">
                <div style="text-align: right; display: flex; flex-direction: column;">
                    <span style="font-weight: 800; font-size: 0.9rem;">{{ user.get_full_name|default:user.username }}</span>
                    <span style="font-size: 0.65rem; opacity: 0.85; font-weight: 800; text-transform: uppercase;">{% if user.passed_out_year %}CLASS OF {{ user.passed_out_year }}{% else %}ALUMNI{% endif %}</span>
                </div>
                <img src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}https://api.dicebear.com/7.x/avataaars/svg?seed={{ user.first_name|default:'User' }}{% endif %}" alt="Profile" style="width: 42px; height: 42px; border-radius: 12px; background-color: white; border: 2px solid var(--rc-accent-gold);">
            </a>
        </div>
    </header>

    <main class="rc-settings-grid">
        <!-- Sidebar Navigation -->
        <aside class="rc-settings-nav">
            <button class="rc-settings-tab active" onclick="switchTab('account', this)">
                <i data-lucide="user" size="20"></i> Account & Verification
            </button>
            <button class="rc-settings-tab" onclick="switchTab('security', this)">
                <i data-lucide="shield-check" size="20"></i> Security
            </button>
            <button class="rc-settings-tab" onclick="switchTab('app', this)">
                <i data-lucide="settings" size="20"></i> App Preferences
            </button>
        </aside>

        <!-- Main Content Area -->
        <section class="rc-settings-content">
            
            <!-- SECTION: ACCOUNT & VERIFIED PROFILE -->
            <div id="section-account">
                <!-- Verified Data (Read Only) -->
                <div class="rc-card" style="margin-bottom: 25px; border-top: 4px solid var(--rc-accent-gold);">
                    <div class="rc-card-title">
                        <i data-lucide="verified" color="var(--rc-accent-gold)"></i> 
                        Verified Enrollment Data
                        <span class="verified-badge">LOCKED BY ADMIN</span>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" class="form-control" value="{{ user.get_full_name }}" disabled title="Contact admin to change this">
                        </div>
                        <div class="form-group">
                            <label>Enrollment Number</label>
                            <input type="text" class="form-control" value="{{ user.enrollment_number }}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Department</label>
                            <input type="text" class="form-control" value="{{ user.department }}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Passed Out Year</label>
                            <input type="text" class="form-control" value="{{ user.passed_out_year|default_if_none:'' }}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Batch</label>
                            <input type="text" class="form-control" value="{{ user.passed_out_year|default_if_none:'' }}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Date of Birth</label>
                            <input type="text" class="form-control" value="{{ user.date_of_birth|default_if_none:'' }}" disabled>
                        </div>
                        <div class="form-group">
                            <label>CGPA</label>
                            <input type="text" class="form-control" value="{{ user.cgpa|default_if_none:'' }}" disabled>
                        </div>
                    </div>
                </div>

                <!-- Modifiable Account Data -->
                <div class="rc-card">
                    <div class="rc-card-title"><i data-lucide="user-plus"></i> Personal Information</div>
                    
                    <div class="form-group">
                        <label>Working Status</label>
                        <select class="form-control" id="workingStatus">
                            <option value="Working Professional" {% if user.working_status == 'Working Professional' %}selected{% endif %}>Working Professional</option>
                            <option value="Entrepreneur / Founder" {% if user.working_status == 'Entrepreneur / Founder' %}selected{% endif %}>Entrepreneur / Founder</option>
                            <option value="Higher Studies" {% if user.working_status == 'Higher Studies' %}selected{% endif %}>Higher Studies</option>
                            <option value="Seeking Opportunities" {% if user.working_status == 'Seeking Opportunities' %}selected{% endif %}>Seeking Opportunities</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Phone Number</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" class="form-control" id="phoneInput" value="{{ user.phone }}">
                            <button class="rc-btn rc-btn-gold" onclick="sendOtp()" id="otpBtn">Verify via OTP</button>
                        </div>
                        <p id="otpMsg" style="font-size: 0.75rem; color: #15803d; font-weight: 700; margin-top: 8px; display: none;">OTP Sent to your number!</p>
                    </div>

                    <div id="otpInputArea" class="form-group hidden">
                        <label>Enter 6-Digit OTP</label>
                        <input type="text" class="form-control" placeholder="X X X X X X" maxlength="6">
                    </div>

                    <button class="rc-btn rc-btn-primary" style="margin-top: 10px;" onclick="saveAccount()">Update Personal Info</button>
                </div>
            </div>

            <!-- SECTION: SECURITY -->
            <div id="section-security" class="hidden">
                <div class="rc-card">
                    <div class="rc-card-title"><i data-lucide="key"></i> Change Password</div>
                    
                    <div class="form-group">
                        <label>Current Password</label>
                        <input type="password" class="form-control" id="currentPassword" placeholder="Type old password">
                    </div>

                    <div class="form-group">
                        <label>New Password</label>
                        <input type="password" class="form-control" id="newPassword" placeholder="Create new password">
                    </div>

                    <div class="form-group">
                        <label>Confirm New Password</label>
                        <input type="password" class="form-control" id="confirmPassword" placeholder="Repeat new password">
                    </div>

                    <button class="rc-btn rc-btn-primary" onclick="updatePassword()">Save New Password</button>
                </div>

                <div class="rc-card" style="margin-top: 25px;">
                    <div class="rc-card-title"><i data-lucide="log-out"></i> Login Sessions</div>
                    <p style="font-size: 0.85rem; color: var(--rc-text-dimmed-color); margin-bottom: 20px; font-weight: 600;">Log out from all other devices for better security.</p>
                    <button class="rc-btn" style="background: #fee2e2; color: #b91c1c; border: 1px solid #fecaca;">Logout Other Sessions</button>
                </div>
            </div>

            <!-- SECTION: APP PREFERENCES -->
            <div id="section-app" class="hidden">
                <div class="rc-card">
                    <div class="rc-card-title"><i data-lucide="smartphone"></i> Application Settings</div>
                    
                    <div class="pref-item">
                        <div class="pref-info">
                            <h4>Public Profile Visibility</h4>
                            <p>Allow juniors and recruiters to find your profile in searches.</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="pref-item">
                        <div class="pref-info">
                            <h4>Email Notifications</h4>
                            <p>Get notified about new events, grants, and messages.</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="pref-item">
                        <div class="pref-info">
                            <h4>Dark Mode</h4>
                            <p>Reduce eye strain during night-time usage (Coming Soon).</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" disabled>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="pref-item">
                        <div class="pref-info">
                            <h4>Analytics Sharing</h4>
                            <p>Share anonymous usage data to help us improve reConnect.</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>

        </section>
    </main>

    <script>
        const NAV_LINKS = [
            { label: 'Dashboard', icon: 'trending-up', href: '{% url "alumni_dashboard" %}' },
            { label: 'Announcements', icon: 'megaphone', href: '{% url "announcements" %}' },
            { label: 'Connect', icon: 'users', href: '{% url "connect" %}' },
            { label: 'Events', icon: 'calendar', href: '{% url "events" %}' },
            { label: 'Share', icon: 'plus-circle', href: '{% url "post" %}' },
            { label: 'Settings', icon: 'settings', href: '{% url "settings" %}', active: true }
        ];

        function renderNav() {
            const container = document.getElementById('navContainer');
            container.innerHTML = NAV_LINKS.map(link => `
                <a href="${link.href}" class="rc-nav-link ${link.active ? 'active' : ''}">
                    <i data-lucide="${link.icon}" size="18"></i>
                    ${link.label}
                </a>
            `).join('');
            lucide.createIcons();
        }

        function toggleNav() { 
            document.getElementById('sidebarOverlay').classList.toggle('open'); 
        }

        function switchTab(section, btn) {
            document.querySelectorAll('.rc-settings-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');

            ['account', 'security', 'app'].forEach(s => {
                document.getElementById(`section-${s}`).classList.add('hidden');
            });
            document.getElementById(`section-${section}`).classList.remove('hidden');
            lucide.createIcons();
        }

        function sendOtp() {
            const btn = document.getElementById('otpBtn');
            const msg = document.getElementById('otpMsg');
            const inputArea = document.getElementById('otpInputArea');
            
            btn.innerText = "Resend OTP";
            msg.style.display = "block";
            inputArea.classList.remove('hidden');
        }

        function saveAccount() {
            const formData = new FormData();
            formData.append('phone', document.getElementById('phoneInput').value);
            formData.append('working_status', document.getElementById('workingStatus').value);
            fetch('{% url "update_profile" %}', {
                method: 'POST',
                headers: { 'X-CSRFToken': getCsrfToken() },
                body: formData
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) alert('Personal information updated successfully!');
                else alert(data.error || 'Update failed');
            })
            .catch(() => alert('Network error'));
        }

        function updatePassword() {
            const formData = new FormData();
            formData.append('current_password', document.getElementById('currentPassword').value);
            formData.append('new_password', document.getElementById('newPassword').value);
            formData.append('confirm_password', document.getElementById('confirmPassword').value);
            fetch('{% url "update_profile" %}', {
                method: 'POST',
                headers: { 'X-CSRFToken': getCsrfToken() },
                body: formData
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    alert('Password changed successfully!');
                    document.getElementById('currentPassword').value = '';
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                } else {
                    alert(data.error || 'Password update failed');
                }
            })
            .catch(() => alert('Network error'));
        }

        function getCsrfToken() {
            const name = 'csrftoken';
            const cookies = document.cookie.split(';');
            for (let c of cookies) {
                c = c.trim();
                if (c.startsWith(name + '=')) return c.substring(name.length + 1);
            }
            return '';
        }

        window.onload = () => {
            renderNav();
            lucide.createIcons();
        };
    </script>
</body>
</html>